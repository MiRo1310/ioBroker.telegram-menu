{
  "version": 3,
  "sources": ["../../src/lib/backMenu.ts"],
  "sourcesContent": ["import { debug, error } from \"./logging\";\r\nimport { BackMenu, NavPart, AllMenusWithData, BooleanString } from \"./telegram-menu\";\r\nimport { checkStatusInfo } from \"./utilities\";\r\nconst backMenu: BackMenu = {};\r\n\r\nfunction backMenuFunc(nav: string, part: NavPart, userToSend: string): void {\r\n\tif (!part || !JSON.stringify(part).split(`\"`)[1].includes(\"menu:\")) {\r\n\t\tif (backMenu[userToSend] && backMenu[userToSend].list.length === 20) {\r\n\t\t\tbackMenu[userToSend].list.shift();\r\n\t\t} else if (!backMenu[userToSend]) {\r\n\t\t\tbackMenu[userToSend] = { list: [], last: \"\" };\r\n\t\t}\r\n\t\tif (backMenu[userToSend].last !== \"\") {\r\n\t\t\tbackMenu[userToSend].list.push(backMenu[userToSend].last);\r\n\t\t}\r\n\t\tbackMenu[userToSend].last = nav;\r\n\t}\r\n\tdebug([{ text: \"GoBackMenu\", val: backMenu }]);\r\n}\r\n\r\nasync function switchBack(\r\n\tuserToSend: string,\r\n\tallMenusWithData: AllMenusWithData,\r\n\tmenus: string[],\r\n\tlastMenu = false,\r\n): Promise<{ texttosend: string | undefined; menuToSend: NavPart; parseMode: BooleanString } | undefined> {\r\n\ttry {\r\n\t\tconst list = backMenu[userToSend] && backMenu[userToSend]?.list ? backMenu[userToSend].list : [];\r\n\t\tlet menuToSend: NavPart | undefined = [];\r\n\t\tlet foundedMenu = \"\";\r\n\t\tif (list.length != 0) {\r\n\t\t\tfor (const menu of menus) {\r\n\t\t\t\tif (lastMenu && allMenusWithData[menu]?.[backMenu[userToSend].last]?.nav) {\r\n\t\t\t\t\tmenuToSend = allMenusWithData[menu][backMenu[userToSend].last].nav;\r\n\t\t\t\t\tfoundedMenu = menu;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t} else if (allMenusWithData[menu][list[list.length - 1]]?.nav && !lastMenu) {\r\n\t\t\t\t\tmenuToSend = allMenusWithData[menu][list[list.length - 1]].nav;\r\n\t\t\t\t\tdebug([{ text: \"Menu call found\" }]);\r\n\t\t\t\t\tfoundedMenu = menu;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tdebug([{ text: \"Menu call not found in this Menu\" }]);\r\n\t\t\t}\r\n\t\t\tif (menuToSend && foundedMenu != \"\") {\r\n\t\t\t\tlet parseMode: BooleanString = \"\" as BooleanString;\r\n\t\t\t\tif (!lastMenu) {\r\n\t\t\t\t\tlet textToSend = allMenusWithData[foundedMenu][backMenu[userToSend].list[backMenu[userToSend].list.length - 1]].text;\r\n\t\t\t\t\tif (textToSend) {\r\n\t\t\t\t\t\ttextToSend = await checkStatusInfo(textToSend);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tparseMode = allMenusWithData[foundedMenu][backMenu[userToSend].list[backMenu[userToSend].list.length - 1]].parse_mode || \"false\";\r\n\t\t\t\t\tbackMenu[userToSend].last = list.pop();\r\n\r\n\t\t\t\t\treturn { texttosend: textToSend, menuToSend: menuToSend, parseMode: parseMode };\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparseMode = allMenusWithData[foundedMenu][backMenu[userToSend].last].parse_mode || \"false\";\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\ttexttosend: allMenusWithData[foundedMenu][backMenu[userToSend].last].text,\r\n\t\t\t\t\t\tmenuToSend: menuToSend,\r\n\t\t\t\t\t\tparseMode: parseMode,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} catch (e: any) {\r\n\t\terror([\r\n\t\t\t{ text: \"Error in switchBack:\", val: e.message },\r\n\t\t\t{ text: \"Stack:\", val: e.stack },\r\n\t\t]);\r\n\t}\r\n}\r\n\r\nexport { switchBack, backMenuFunc };\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAA6B;AAE7B,uBAAgC;AAChC,MAAM,WAAqB,CAAC;AAE5B,SAAS,aAAa,KAAa,MAAe,YAA0B;AAC3E,MAAI,CAAC,QAAQ,CAAC,KAAK,UAAU,IAAI,EAAE,MAAM,GAAG,EAAE,GAAG,SAAS,OAAO,GAAG;AACnE,QAAI,SAAS,eAAe,SAAS,YAAY,KAAK,WAAW,IAAI;AACpE,eAAS,YAAY,KAAK,MAAM;AAAA,IACjC,WAAW,CAAC,SAAS,aAAa;AACjC,eAAS,cAAc,EAAE,MAAM,CAAC,GAAG,MAAM,GAAG;AAAA,IAC7C;AACA,QAAI,SAAS,YAAY,SAAS,IAAI;AACrC,eAAS,YAAY,KAAK,KAAK,SAAS,YAAY,IAAI;AAAA,IACzD;AACA,aAAS,YAAY,OAAO;AAAA,EAC7B;AACA,4BAAM,CAAC,EAAE,MAAM,cAAc,KAAK,SAAS,CAAC,CAAC;AAC9C;AAEA,eAAe,WACd,YACA,kBACA,OACA,WAAW,OAC8F;AAzB1G;AA0BC,MAAI;AACH,UAAM,OAAO,SAAS,iBAAe,cAAS,gBAAT,mBAAsB,QAAO,SAAS,YAAY,OAAO,CAAC;AAC/F,QAAI,aAAkC,CAAC;AACvC,QAAI,cAAc;AAClB,QAAI,KAAK,UAAU,GAAG;AACrB,iBAAW,QAAQ,OAAO;AACzB,YAAI,cAAY,4BAAiB,UAAjB,mBAAyB,SAAS,YAAY,UAA9C,mBAAqD,MAAK;AACzE,uBAAa,iBAAiB,MAAM,SAAS,YAAY,MAAM;AAC/D,wBAAc;AACd;AAAA,QACD,aAAW,sBAAiB,MAAM,KAAK,KAAK,SAAS,QAA1C,mBAA+C,QAAO,CAAC,UAAU;AAC3E,uBAAa,iBAAiB,MAAM,KAAK,KAAK,SAAS,IAAI;AAC3D,oCAAM,CAAC,EAAE,MAAM,kBAAkB,CAAC,CAAC;AACnC,wBAAc;AACd;AAAA,QACD;AACA,kCAAM,CAAC,EAAE,MAAM,mCAAmC,CAAC,CAAC;AAAA,MACrD;AACA,UAAI,cAAc,eAAe,IAAI;AACpC,YAAI,YAA2B;AAC/B,YAAI,CAAC,UAAU;AACd,cAAI,aAAa,iBAAiB,aAAa,SAAS,YAAY,KAAK,SAAS,YAAY,KAAK,SAAS,IAAI;AAChH,cAAI,YAAY;AACf,yBAAa,UAAM,kCAAgB,UAAU;AAAA,UAC9C;AACA,sBAAY,iBAAiB,aAAa,SAAS,YAAY,KAAK,SAAS,YAAY,KAAK,SAAS,IAAI,cAAc;AACzH,mBAAS,YAAY,OAAO,KAAK,IAAI;AAErC,iBAAO,EAAE,YAAY,YAAY,YAAwB,UAAqB;AAAA,QAC/E,OAAO;AACN,sBAAY,iBAAiB,aAAa,SAAS,YAAY,MAAM,cAAc;AACnF,iBAAO;AAAA,YACN,YAAY,iBAAiB,aAAa,SAAS,YAAY,MAAM;AAAA,YACrE;AAAA,YACA;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD,SAAS,GAAP;AACD,8BAAM;AAAA,MACL,EAAE,MAAM,wBAAwB,KAAK,EAAE,QAAQ;AAAA,MAC/C,EAAE,MAAM,UAAU,KAAK,EAAE,MAAM;AAAA,IAChC,CAAC;AAAA,EACF;AACD;",
  "names": []
}
