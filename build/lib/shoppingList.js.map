{
  "version": 3,
  "sources": ["../../src/lib/shoppingList.ts"],
  "sourcesContent": ["import { deleteMessageIds } from \"./messageIds.js\";\r\nimport { createKeyboardFromJson } from \"./jsonTable.js\";\r\nimport { sendToTelegramSubmenu, sendToTelegram } from \"./telegram.js\";\r\nimport { _subscribeAndUnSubscribeForeignStatesAsync } from \"./subscribeStates.js\";\r\nimport { debug, error } from \"./logging.js\";\r\nimport TelegramMenu from \"../main.js\";\r\n\r\ninterface ObjectData {\r\n\t[key: string]: {\r\n\t\tidList: string;\r\n\t};\r\n}\r\nconst objData: ObjectData = {};\r\n\r\nlet isSubscribed = false;\r\n\r\nasync function shoppingListSubscribeStateAndDeleteItem(\r\n\tval: string | null,\r\n\tinstanceTelegram: string,\r\n\tuserListWithChatID: UserListWithChatId[],\r\n\tresize_keyboard: boolean,\r\n\tone_time_keyboard: boolean,\r\n): Promise<void> {\r\n\tconst _this = TelegramMenu.getInstance();\r\n\ttry {\r\n\t\tlet array, user, idList, instance, idItem, res;\r\n\t\tif (val != null) {\r\n\t\t\tarray = val.split(\":\");\r\n\t\t\tuser = array[0].replace(\"[\", \"\").replace(\"]sList\", \"\");\r\n\t\t\tidList = array[1];\r\n\t\t\tinstance = array[2];\r\n\t\t\tidItem = array[3];\r\n\t\t\tres = await _this.getForeignObjectAsync(`alexa2.${instance}.Lists.SHOPPING_LIST.items.${idItem}`);\r\n\r\n\t\t\tif (res) {\r\n\t\t\t\tobjData[user] = { idList: idList };\r\n\t\t\t\tdebug([{ text: \"alexa-shoppinglist.\", val: idList }]);\r\n\t\t\t\tif (!isSubscribed) {\r\n\t\t\t\t\tawait _subscribeAndUnSubscribeForeignStatesAsync({ id: `alexa-shoppinglist.${idList}` });\r\n\t\t\t\t\tisSubscribed = true;\r\n\t\t\t\t}\r\n\t\t\t\tawait _this.setForeignStateAsync(`alexa2.${instance}.Lists.SHOPPING_LIST.items.${idItem}.#delete`, true, false);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tsendToTelegram(\r\n\t\t\t\tuser,\r\n\t\t\t\t\"Cannot delete the Item\",\r\n\t\t\t\tundefined,\r\n\t\t\t\tinstanceTelegram,\r\n\t\t\t\tresize_keyboard,\r\n\t\t\t\tone_time_keyboard,\r\n\t\t\t\tuserListWithChatID,\r\n\t\t\t\t\"true\",\r\n\t\t\t);\r\n\t\t\tdebug([{ text: \"Cannot delete the Item\" }]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t} catch (e: any) {\r\n\t\terror([\r\n\t\t\t{ text: \"Error shoppingList:\", val: e.message },\r\n\t\t\t{ text: \"Stack:\", val: e.stack },\r\n\t\t]);\r\n\t}\r\n}\r\n\r\nasync function deleteMessageAndSendNewShoppingList(\r\n\tinstanceTelegram: string,\r\n\tuserListWithChatID: UserListWithChatId[],\r\n\tuserToSend: string,\r\n): Promise<void> {\r\n\tconst _this = TelegramMenu.getInstance();\r\n\ttry {\r\n\t\tconst user = userToSend;\r\n\t\tconst idList = objData[user].idList;\r\n\t\t_subscribeAndUnSubscribeForeignStatesAsync({ id: `alexa-shoppinglist.${idList}` });\r\n\t\tawait deleteMessageIds(user, userListWithChatID, instanceTelegram, \"last\");\r\n\r\n\t\tconst result = await _this.getForeignStateAsync(\"alexa-shoppinglist.\" + idList);\r\n\t\tif (result && result.val) {\r\n\t\t\tdebug([{ text: \"Result from Shoppinglist:\", val: result }]);\r\n\t\t\tconst newId = `alexa-shoppinglist.${idList}`;\r\n\t\t\tconst resultJson = createKeyboardFromJson(result.val as string, null, newId, user);\r\n\t\t\tif (resultJson && resultJson.text && resultJson.keyboard) {\r\n\t\t\t\tsendToTelegramSubmenu(user, resultJson.text, resultJson.keyboard, instanceTelegram, userListWithChatID, \"true\");\r\n\t\t\t}\r\n\t\t}\r\n\t} catch (e: any) {\r\n\t\terror([\r\n\t\t\t{ text: \"Error deleteMessageAndSendNewShoppingList:\", val: e.message },\r\n\t\t\t{ text: \"Stack:\", val: e.stack },\r\n\t\t]);\r\n\t}\r\n}\r\n\r\nexport { shoppingListSubscribeStateAndDeleteItem, deleteMessageAndSendNewShoppingList };\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAAiC;AACjC,uBAAuC;AACvC,sBAAsD;AACtD,6BAA2D;AAC3D,qBAA6B;AAC7B,kBAAyB;AAOzB,MAAM,UAAsB,CAAC;AAE7B,IAAI,eAAe;AAEnB,eAAe,wCACd,KACA,kBACA,oBACA,iBACA,mBACgB;AAChB,QAAM,QAAQ,YAAAA,QAAa,YAAY;AACvC,MAAI;AACH,QAAI,OAAO,MAAM,QAAQ,UAAU,QAAQ;AAC3C,QAAI,OAAO,MAAM;AAChB,cAAQ,IAAI,MAAM,GAAG;AACrB,aAAO,MAAM,GAAG,QAAQ,KAAK,EAAE,EAAE,QAAQ,UAAU,EAAE;AACrD,eAAS,MAAM;AACf,iBAAW,MAAM;AACjB,eAAS,MAAM;AACf,YAAM,MAAM,MAAM,sBAAsB,UAAU,sCAAsC,QAAQ;AAEhG,UAAI,KAAK;AACR,gBAAQ,QAAQ,EAAE,OAAe;AACjC,kCAAM,CAAC,EAAE,MAAM,uBAAuB,KAAK,OAAO,CAAC,CAAC;AACpD,YAAI,CAAC,cAAc;AAClB,oBAAM,mEAA2C,EAAE,IAAI,sBAAsB,SAAS,CAAC;AACvF,yBAAe;AAAA,QAChB;AACA,cAAM,MAAM,qBAAqB,UAAU,sCAAsC,kBAAkB,MAAM,KAAK;AAC9G;AAAA,MACD;AACA;AAAA,QACC;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACD;AACA,gCAAM,CAAC,EAAE,MAAM,yBAAyB,CAAC,CAAC;AAC1C;AAAA,IACD;AAAA,EACD,SAAS,GAAP;AACD,8BAAM;AAAA,MACL,EAAE,MAAM,uBAAuB,KAAK,EAAE,QAAQ;AAAA,MAC9C,EAAE,MAAM,UAAU,KAAK,EAAE,MAAM;AAAA,IAChC,CAAC;AAAA,EACF;AACD;AAEA,eAAe,oCACd,kBACA,oBACA,YACgB;AAChB,QAAM,QAAQ,YAAAA,QAAa,YAAY;AACvC,MAAI;AACH,UAAM,OAAO;AACb,UAAM,SAAS,QAAQ,MAAM;AAC7B,2EAA2C,EAAE,IAAI,sBAAsB,SAAS,CAAC;AACjF,cAAM,oCAAiB,MAAM,oBAAoB,kBAAkB,MAAM;AAEzE,UAAM,SAAS,MAAM,MAAM,qBAAqB,wBAAwB,MAAM;AAC9E,QAAI,UAAU,OAAO,KAAK;AACzB,gCAAM,CAAC,EAAE,MAAM,6BAA6B,KAAK,OAAO,CAAC,CAAC;AAC1D,YAAM,QAAQ,sBAAsB;AACpC,YAAM,iBAAa,yCAAuB,OAAO,KAAe,MAAM,OAAO,IAAI;AACjF,UAAI,cAAc,WAAW,QAAQ,WAAW,UAAU;AACzD,mDAAsB,MAAM,WAAW,MAAM,WAAW,UAAU,kBAAkB,oBAAoB,MAAM;AAAA,MAC/G;AAAA,IACD;AAAA,EACD,SAAS,GAAP;AACD,8BAAM;AAAA,MACL,EAAE,MAAM,8CAA8C,KAAK,EAAE,QAAQ;AAAA,MACrE,EAAE,MAAM,UAAU,KAAK,EAAE,MAAM;AAAA,IAChC,CAAC;AAAA,EACF;AACD;",
  "names": ["TelegramMenu"]
}
