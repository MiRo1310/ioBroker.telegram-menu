{
  "version": 3,
  "sources": ["../../src/app/telegram.ts"],
  "sourcesContent": ["import { errorLogger } from './logging';\nimport { textModifier } from '../lib/utilities';\nimport { adapter } from '../main';\nimport type { Keyboard, Location, Telegram, TelegramParams } from '../types/types';\nimport { getChatID } from '../lib/utils';\nimport { cleanUpString, isEmptyString, jsonString } from '../lib/string';\nimport { getParseMode } from '../lib/appUtils';\nimport { isInstanceActive } from './instance';\n\nfunction validateTextToSend(textToSend: string | undefined): boolean {\n    if (!textToSend || isEmptyString(textToSend)) {\n        adapter.log.error('There is a problem! Text to send is empty or undefined, please check your configuration.');\n        return false;\n    }\n    if (textToSend.includes('change{')) {\n        adapter.log.warn(\n            \"To use 'change{'. The status must have a param to be exchanged, like: {status:'ID':true}. If you use it in another way, and it doesn't work, please check your configuration. If nothing helps, please open an issue on GitHub.\",\n        );\n    }\n    return true;\n}\n\nasync function sendToTelegram({\n    instance,\n    userToSend,\n    textToSend,\n    keyboard,\n    telegramParams,\n    parse_mode,\n}: Telegram): Promise<void> {\n    try {\n        const { resize_keyboard, one_time_keyboard, userListWithChatID } = telegramParams;\n        const chatId = getChatID(userListWithChatID, userToSend);\n\n        if (!instance || !isInstanceActive(telegramParams.telegramInstanceList, instance)) {\n            return;\n        }\n        adapter.log.debug(\n            `Send to: { user: ${userToSend} , chatId :${chatId} , text: ${textToSend} , instance: ${instance} , userListWithChatID: ${jsonString(userListWithChatID)} , parseMode: ${parse_mode} }`,\n        );\n        validateTextToSend(textToSend);\n\n        if (!keyboard) {\n            adapter.sendTo(\n                instance,\n                'send',\n                {\n                    text: cleanUpString(textToSend),\n                    chatId,\n                    parse_mode: getParseMode(parse_mode),\n                },\n                res => telegramLogger(res),\n            );\n            return;\n        }\n\n        adapter.sendTo(\n            instance,\n            'send',\n            {\n                chatId,\n                parse_mode: getParseMode(parse_mode),\n                text: await textModifier(cleanUpString(textToSend)),\n                reply_markup: {\n                    keyboard,\n                    resize_keyboard,\n                    one_time_keyboard,\n                },\n            },\n            res => telegramLogger(res),\n        );\n    } catch (e) {\n        errorLogger('Error sendToTelegram:', e, adapter);\n    }\n}\n\nfunction sendToTelegramSubmenu(\n    telegramInstance: string,\n    user: string,\n    textToSend: string,\n    keyboard: Keyboard,\n    telegramParams: TelegramParams,\n    parse_mode?: boolean,\n): void {\n    const { userListWithChatID } = telegramParams;\n    if (!validateTextToSend(textToSend)) {\n        return;\n    }\n\n    adapter.sendTo(\n        telegramInstance,\n        'send',\n        {\n            chatId: getChatID(userListWithChatID, user),\n            parse_mode: getParseMode(parse_mode),\n            text: cleanUpString(textToSend),\n            reply_markup: keyboard,\n        },\n        (res: any) => telegramLogger(res),\n    );\n}\n\nconst sendLocationToTelegram = async (\n    telegramInstance: string,\n    user: string,\n    data: Location[],\n    telegramParams: TelegramParams,\n): Promise<void> => {\n    const { userListWithChatID } = telegramParams;\n    try {\n        const chatId = getChatID(userListWithChatID, user);\n\n        for (const { longitude: longitudeID, latitude: latitudeID } of data) {\n            if (!(latitudeID || longitudeID)) {\n                continue;\n            }\n\n            const latitude = await adapter.getForeignStateAsync(latitudeID);\n            const longitude = await adapter.getForeignStateAsync(longitudeID);\n            if (!latitude || !longitude) {\n                continue;\n            }\n            adapter.sendTo(\n                telegramInstance,\n                {\n                    chatId: chatId,\n                    latitude: latitude.val,\n                    longitude: longitude.val,\n                    disable_notification: true,\n                },\n                (res: any) => telegramLogger(res),\n            );\n        }\n    } catch (e: any) {\n        errorLogger('Error send location to telegram:', e, adapter);\n    }\n};\n\nfunction telegramLogger(res: any): void {\n    adapter.log.debug(`Telegram response : \"${jsonString(res)}\"`);\n}\n\nexport { sendToTelegram, sendToTelegramSubmenu, sendLocationToTelegram };\n"],
  "mappings": "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",
  "names": []
}
