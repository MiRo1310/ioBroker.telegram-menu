{
  "version": 3,
  "sources": ["../../src/app/shoppingList.ts"],
  "sourcesContent": ["import { deleteMessageIds } from './messageIds.js';\nimport { createKeyboardFromJson } from './jsonTable.js';\nimport { sendToTelegram, sendToTelegramSubmenu } from './telegram.js';\nimport { _subscribeAndUnSubscribeForeignStatesAsync } from './subscribeStates.js';\nimport { errorLogger } from './logging.js';\nimport { adapter } from '../main.js';\nimport type { TelegramParams } from '../types/types.js';\nimport { jsonString } from '../lib/string';\nimport { setstateIobroker } from './setstate';\n\ninterface ObjectData {\n    [key: string]: {\n        idList: string;\n    };\n}\nconst objData: ObjectData = {};\n\nlet isSubscribed = false;\n\nexport async function shoppingListSubscribeStateAndDeleteItem(\n    val: string | null,\n    telegramParams: TelegramParams,\n): Promise<void> {\n    try {\n        let array, user, idList, instance, idItem, res;\n        if (val != null) {\n            array = val.split(':');\n            user = array[0].replace('[', '').replace(']sList', '');\n            idList = array[1];\n            instance = array[2];\n            idItem = array[3];\n            res = await adapter.getForeignObjectAsync(`alexa2.${instance}.Lists.SHOPPING_LIST.items.${idItem}`);\n\n            if (res) {\n                objData[user] = { idList: idList };\n                adapter.log.debug(`Alexa-shoppinglist: ${idList}`);\n                if (!isSubscribed) {\n                    await _subscribeAndUnSubscribeForeignStatesAsync({ id: `alexa-shoppinglist.${idList}` });\n                    isSubscribed = true;\n                }\n                await setstateIobroker({\n                    id: `alexa2.${instance}.Lists.SHOPPING_LIST.items.${idItem}.#delete`,\n                    value: true,\n                    ack: false,\n                });\n                return;\n            }\n            await sendToTelegram({\n                userToSend: user,\n                textToSend: 'Cannot delete the Item',\n                telegramParams,\n                parse_mode: true,\n            });\n            adapter.log.debug('Cannot delete the Item');\n            return;\n        }\n    } catch (e: any) {\n        errorLogger('Error shoppingList:', e, adapter);\n    }\n}\n\nexport async function deleteMessageAndSendNewShoppingList(\n    telegramParams: TelegramParams,\n    userToSend: string,\n): Promise<void> {\n    try {\n        const user = userToSend;\n        const idList = objData[user].idList;\n        await _subscribeAndUnSubscribeForeignStatesAsync({ id: `alexa-shoppinglist.${idList}` });\n        await deleteMessageIds(user, telegramParams, 'last');\n\n        const result = await adapter.getForeignStateAsync(`alexa-shoppinglist.${idList}`);\n        if (result?.val) {\n            adapter.log.debug(`Result from Shoppinglist: ${jsonString(result)}`);\n            const newId = `alexa-shoppinglist.${idList}`;\n            const resultJson = createKeyboardFromJson(JSON.stringify(result.val, null, 2), null, newId, user);\n            if (resultJson?.text && resultJson?.keyboard) {\n                sendToTelegramSubmenu(user, resultJson.text, resultJson.keyboard, telegramParams, true);\n            }\n        }\n    } catch (e: any) {\n        errorLogger('Error deleteMessageAndSendNewShoppingList:', e, adapter);\n    }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wBAAiC;AACjC,uBAAuC;AACvC,sBAAsD;AACtD,6BAA2D;AAC3D,qBAA4B;AAC5B,kBAAwB;AAExB,oBAA2B;AAC3B,sBAAiC;AAOjC,MAAM,UAAsB,CAAC;AAE7B,IAAI,eAAe;AAEnB,eAAsB,wCAClB,KACA,gBACa;AACb,MAAI;AACA,QAAI,OAAO,MAAM,QAAQ,UAAU,QAAQ;AAC3C,QAAI,OAAO,MAAM;AACb,cAAQ,IAAI,MAAM,GAAG;AACrB,aAAO,MAAM,CAAC,EAAE,QAAQ,KAAK,EAAE,EAAE,QAAQ,UAAU,EAAE;AACrD,eAAS,MAAM,CAAC;AAChB,iBAAW,MAAM,CAAC;AAClB,eAAS,MAAM,CAAC;AAChB,YAAM,MAAM,oBAAQ,sBAAsB,UAAU,QAAQ,8BAA8B,MAAM,EAAE;AAElG,UAAI,KAAK;AACL,gBAAQ,IAAI,IAAI,EAAE,OAAe;AACjC,4BAAQ,IAAI,MAAM,uBAAuB,MAAM,EAAE;AACjD,YAAI,CAAC,cAAc;AACf,oBAAM,mEAA2C,EAAE,IAAI,sBAAsB,MAAM,GAAG,CAAC;AACvF,yBAAe;AAAA,QACnB;AACA,kBAAM,kCAAiB;AAAA,UACnB,IAAI,UAAU,QAAQ,8BAA8B,MAAM;AAAA,UAC1D,OAAO;AAAA,UACP,KAAK;AAAA,QACT,CAAC;AACD;AAAA,MACJ;AACA,gBAAM,gCAAe;AAAA,QACjB,YAAY;AAAA,QACZ,YAAY;AAAA,QACZ;AAAA,QACA,YAAY;AAAA,MAChB,CAAC;AACD,0BAAQ,IAAI,MAAM,wBAAwB;AAC1C;AAAA,IACJ;AAAA,EACJ,SAAS,GAAQ;AACb,oCAAY,uBAAuB,GAAG,mBAAO;AAAA,EACjD;AACJ;AAEA,eAAsB,oCAClB,gBACA,YACa;AACb,MAAI;AACA,UAAM,OAAO;AACb,UAAM,SAAS,QAAQ,IAAI,EAAE;AAC7B,cAAM,mEAA2C,EAAE,IAAI,sBAAsB,MAAM,GAAG,CAAC;AACvF,cAAM,oCAAiB,MAAM,gBAAgB,MAAM;AAEnD,UAAM,SAAS,MAAM,oBAAQ,qBAAqB,sBAAsB,MAAM,EAAE;AAChF,QAAI,iCAAQ,KAAK;AACb,0BAAQ,IAAI,MAAM,iCAA6B,0BAAW,MAAM,CAAC,EAAE;AACnE,YAAM,QAAQ,sBAAsB,MAAM;AAC1C,YAAM,iBAAa,yCAAuB,KAAK,UAAU,OAAO,KAAK,MAAM,CAAC,GAAG,MAAM,OAAO,IAAI;AAChG,WAAI,yCAAY,UAAQ,yCAAY,WAAU;AAC1C,mDAAsB,MAAM,WAAW,MAAM,WAAW,UAAU,gBAAgB,IAAI;AAAA,MAC1F;AAAA,IACJ;AAAA,EACJ,SAAS,GAAQ;AACb,oCAAY,8CAA8C,GAAG,mBAAO;AAAA,EACxE;AACJ;",
  "names": []
}
