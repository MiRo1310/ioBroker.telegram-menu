{
  "version": 3,
  "sources": ["../../src/app/processData.ts"],
  "sourcesContent": ["import { adapter } from '../main';\nimport { sendLocationToTelegram, sendToTelegram } from './telegram';\nimport { sendNav } from './sendNav';\nimport { callSubMenu } from './subMenu';\nimport { backMenuFunc, switchBack } from './backMenu';\nimport { setState } from './setstate';\nimport { getState } from './getstate';\nimport { sendPic } from './sendpic';\nimport { getDynamicValue, removeUserFromDynamicValue } from './dynamicValue';\nimport { adjustValueType } from './action';\nimport { _subscribeAndUnSubscribeForeignStatesAsync } from './subscribeStates';\nimport { getChart } from './echarts';\nimport { httpRequest } from './httpRequest';\nimport { errorLogger } from './logging';\nimport type { CheckEveryMenuForDataType, Part, ProcessDataType, SetStateIds, Timeouts } from '../types/types';\nimport { jsonString } from '../lib/string';\n\nlet setStateIdsToListenTo: SetStateIds[] = [];\nlet timeouts: Timeouts[] = [];\n\nasync function checkEveryMenuForData(obj: CheckEveryMenuForDataType): Promise<boolean> {\n    const {\n        menuData,\n        calledValue,\n        userToSend,\n        telegramInstance,\n        resize_keyboard,\n        one_time_keyboard,\n        userListWithChatID,\n        menus,\n        isUserActiveCheckbox,\n        token,\n        directoryPicture,\n        timeoutKey,\n    } = obj;\n\n    for (const menu of menus) {\n        const groupData = menuData[menu];\n\n        adapter.log.debug(`Menu: ${menu}`);\n        adapter.log.debug(`Nav: ${jsonString(menuData[menu])}`);\n\n        if (\n            await processData({\n                menuData,\n                calledValue,\n                userToSend,\n                groupWithUser: menu,\n                telegramInstance,\n                resize_keyboard,\n                one_time_keyboard,\n                userListWithChatID,\n                allMenusWithData: menuData,\n                menus,\n                isUserActiveCheckbox,\n                token,\n                directoryPicture,\n                timeoutKey,\n                groupData,\n            })\n        ) {\n            adapter.log.debug('CalledText found');\n            return true;\n        }\n    }\n    return false;\n}\n\nasync function processData(obj: ProcessDataType): Promise<boolean | undefined> {\n    const {\n        menuData,\n        calledValue,\n        userToSend,\n        groupWithUser,\n        telegramInstance,\n        resize_keyboard,\n        one_time_keyboard,\n        userListWithChatID,\n        allMenusWithData,\n        menus,\n        isUserActiveCheckbox,\n        token,\n        directoryPicture,\n        timeoutKey,\n        groupData,\n    } = obj;\n    try {\n        let part: Part | undefined = {} as Part;\n\n        if (getDynamicValue(userToSend)) {\n            const res = getDynamicValue(userToSend);\n            const valueToSet = res?.valueType ? adjustValueType(calledValue, res.valueType) : calledValue;\n\n            valueToSet && res?.id\n                ? await adapter.setForeignStateAsync(res.id, valueToSet, res?.ack)\n                : await sendToTelegram({\n                      userToSend,\n                      textToSend: `You insert a wrong Type of value, please insert type: ${res?.valueType}`,\n                      telegramInstance,\n                      resize_keyboard,\n                      one_time_keyboard,\n                      userListWithChatID,\n                  });\n\n            removeUserFromDynamicValue(userToSend);\n            const result = await switchBack(userToSend, allMenusWithData, menus, true);\n\n            if (result) {\n                const { textToSend, menuToSend, parse_mode } = result;\n                await sendToTelegram({\n                    userToSend,\n                    textToSend,\n                    keyboard: menuToSend,\n                    telegramInstance,\n                    resize_keyboard,\n                    one_time_keyboard,\n                    userListWithChatID,\n                    parse_mode,\n                });\n                return true;\n            }\n            await sendNav(part, userToSend, telegramInstance, userListWithChatID, resize_keyboard, one_time_keyboard);\n\n            return true;\n        }\n\n        const call = calledValue.includes('menu:') ? calledValue.split(':')[2] : calledValue;\n        part = groupData[call];\n\n        if (!calledValue.toString().includes('menu:') && isUserActiveCheckbox[groupWithUser]) {\n            if (part?.nav) {\n                adapter.log.debug(`Menu to Send: ${jsonString(part.nav)}`);\n\n                backMenuFunc({ startSide: call, navigation: part.nav, userToSend });\n\n                if (jsonString(part.nav).includes('menu:')) {\n                    adapter.log.debug(`Submenu: ${jsonString(part.nav)}`);\n\n                    const result = await callSubMenu(\n                        jsonString(part.nav),\n                        groupData,\n                        userToSend,\n                        telegramInstance,\n                        resize_keyboard,\n                        one_time_keyboard,\n                        userListWithChatID,\n                        part,\n                        allMenusWithData,\n                        menus,\n                        setStateIdsToListenTo,\n                        part.nav,\n                    );\n                    if (result?.setStateIdsToListenTo) {\n                        setStateIdsToListenTo = result.setStateIdsToListenTo;\n                    }\n                    if (result?.newNav) {\n                        await checkEveryMenuForData({\n                            menuData,\n                            calledValue: result.newNav,\n                            userToSend,\n                            telegramInstance: telegramInstance,\n                            resize_keyboard,\n                            one_time_keyboard,\n                            userListWithChatID,\n                            menus,\n                            isUserActiveCheckbox,\n                            token,\n                            directoryPicture,\n                            timeoutKey,\n                        });\n                    }\n                    return true;\n                }\n                await sendNav(\n                    part,\n                    userToSend,\n                    telegramInstance,\n                    userListWithChatID,\n                    resize_keyboard,\n                    one_time_keyboard,\n                );\n                return true;\n            }\n\n            if (part?.switch) {\n                const result = await setState(\n                    part,\n                    userToSend,\n                    0,\n                    false,\n                    telegramInstance,\n                    resize_keyboard,\n                    one_time_keyboard,\n                    userListWithChatID,\n                );\n                if (result) {\n                    setStateIdsToListenTo = result;\n                }\n                if (Array.isArray(setStateIdsToListenTo)) {\n                    await _subscribeAndUnSubscribeForeignStatesAsync({ array: setStateIdsToListenTo });\n                }\n                return true;\n            }\n\n            if (part?.getData) {\n                getState(part, userToSend, telegramInstance, one_time_keyboard, resize_keyboard, userListWithChatID);\n                return true;\n            }\n\n            if (part?.sendPic) {\n                const result = sendPic(\n                    part,\n                    userToSend,\n                    telegramInstance,\n                    resize_keyboard,\n                    one_time_keyboard,\n                    userListWithChatID,\n                    token,\n                    directoryPicture,\n                    timeouts,\n                    timeoutKey,\n                );\n                if (result) {\n                    timeouts = result;\n                    return true;\n                }\n                adapter.log.debug(`Timeouts not found`);\n                return true;\n            }\n\n            if (part?.location) {\n                adapter.log.debug('Send location');\n                await sendLocationToTelegram(userToSend, part.location, telegramInstance, userListWithChatID);\n                return true;\n            }\n\n            if (part?.echarts) {\n                adapter.log.debug('Send echars');\n                getChart(\n                    part.echarts,\n                    directoryPicture,\n                    userToSend,\n                    telegramInstance,\n                    userListWithChatID,\n                    resize_keyboard,\n                    one_time_keyboard,\n                );\n                return true;\n            }\n\n            if (part?.httpRequest) {\n                adapter.log.debug('Send http request');\n                const result = await httpRequest(\n                    part,\n                    userToSend,\n                    telegramInstance,\n                    resize_keyboard,\n                    one_time_keyboard,\n                    userListWithChatID,\n                    directoryPicture,\n                );\n\n                return !!result;\n            }\n        }\n        if ((calledValue.startsWith('menu') || calledValue.startsWith('submenu')) && menuData[groupWithUser][call]) {\n            adapter.log.debug('Call Submenu');\n            const result = await callSubMenu(\n                calledValue,\n                menuData,\n                userToSend,\n                telegramInstance,\n                resize_keyboard,\n                one_time_keyboard,\n                userListWithChatID,\n                part,\n                allMenusWithData,\n                menus,\n                setStateIdsToListenTo,\n                part.nav,\n            );\n            if (result && result.setStateIdsToListenTo) {\n                setStateIdsToListenTo = result.setStateIdsToListenTo;\n            }\n            return true;\n        }\n        return false;\n    } catch (e: any) {\n        errorLogger('Error processData:', e, adapter);\n    }\n}\n\nfunction getStateIdsToListenTo(): SetStateIds[] {\n    return setStateIdsToListenTo;\n}\n\nfunction getTimeouts(): Timeouts[] {\n    return timeouts;\n}\n\nexport { getStateIdsToListenTo, getTimeouts, checkEveryMenuForData };\n"],
  "mappings": "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",
  "names": []
}
