{
  "version": 3,
  "sources": ["../../src/app/processData.ts"],
  "sourcesContent": ["import { adapter } from '../main';\nimport { sendLocationToTelegram, sendToTelegram } from './telegram';\nimport { sendNav } from './sendNav';\nimport { callSubMenu } from './subMenu';\nimport { backMenuFunc, switchBack } from './backMenu';\nimport { handleSetState, setstateIobroker } from './setstate';\nimport { getState } from './getstate';\nimport { sendPic } from './sendpic';\nimport { getDynamicValue, removeUserFromDynamicValue } from './dynamicValue';\nimport { adjustValueType } from './action';\nimport { getChart } from './echarts';\nimport { httpRequest } from './httpRequest';\nimport { errorLogger } from './logging';\nimport type { CheckEveryMenuForDataType, Part, ProcessDataType, Timeouts } from '../types/types';\nimport { jsonString } from '../lib/string';\nimport { isSubmenuOrMenu } from './validateMenus';\n\nlet timeouts: Timeouts[] = [];\n\nexport async function checkEveryMenuForData({\n    instance,\n    menuData,\n    navToGoTo,\n    userToSend,\n    telegramParams,\n    menus,\n    isUserActiveCheckbox,\n    token,\n    directoryPicture,\n    timeoutKey,\n}: CheckEveryMenuForDataType): Promise<boolean> {\n    for (const menu of menus) {\n        const groupData = menuData[menu];\n\n        adapter.log.debug(`Menu : ${menu}`);\n        adapter.log.debug(`Nav : ${jsonString(menuData[menu])}`);\n\n        if (\n            await processData({\n                instance,\n                menuData,\n                calledValue: navToGoTo,\n                userToSend,\n                groupWithUser: menu,\n                telegramParams,\n                allMenusWithData: menuData,\n                menus,\n                isUserActiveCheckbox,\n                token,\n                directoryPicture,\n                timeoutKey,\n                groupData,\n            })\n        ) {\n            adapter.log.debug('Menu found');\n            return true;\n        }\n    }\n    return false;\n}\n\nasync function processData({\n    instance,\n    menuData,\n    calledValue,\n    userToSend,\n    groupWithUser,\n    telegramParams,\n    allMenusWithData,\n    menus,\n    isUserActiveCheckbox,\n    token,\n    directoryPicture,\n    timeoutKey,\n    groupData,\n}: ProcessDataType): Promise<boolean | undefined> {\n    try {\n        let part: Part | undefined = {} as Part;\n\n        const dynamicValue = getDynamicValue(userToSend);\n        if (dynamicValue) {\n            const valueToSet = dynamicValue?.valueType\n                ? adjustValueType(calledValue, dynamicValue.valueType)\n                : calledValue;\n\n            valueToSet && dynamicValue?.id\n                ? await setstateIobroker({ id: dynamicValue.id, value: valueToSet, ack: dynamicValue?.ack })\n                : await sendToTelegram({\n                      instance,\n                      userToSend,\n                      textToSend: `You insert a wrong Type of value, please insert type : ${dynamicValue?.valueType}`,\n                      telegramParams,\n                  });\n\n            removeUserFromDynamicValue(userToSend);\n            const result = await switchBack(userToSend, allMenusWithData, menus, true);\n\n            if (result && !dynamicValue.navToGoTo) {\n                const { textToSend, keyboard, parse_mode } = result;\n                await sendToTelegram({ instance, userToSend, textToSend, keyboard, telegramParams, parse_mode });\n                return true;\n            }\n\n            await sendNav(instance, part, userToSend, telegramParams);\n            return true;\n        }\n\n        const call = calledValue.includes('menu:') ? calledValue.split(':')[2] : calledValue;\n        part = groupData[call];\n\n        if (!calledValue.toString().includes('menu:') && isUserActiveCheckbox[groupWithUser]) {\n            const nav = part?.nav;\n            if (nav) {\n                adapter.log.debug(`Menu to Send: ${jsonString(nav)}`);\n\n                backMenuFunc({ activePage: call, navigation: nav, userToSend });\n\n                if (jsonString(nav).includes('menu:')) {\n                    adapter.log.debug(`Submenu: ${jsonString(nav)}`);\n\n                    const result = await callSubMenu({\n                        instance,\n                        jsonStringNav: jsonString(nav),\n                        userToSend,\n                        telegramParams,\n                        part,\n                        allMenusWithData,\n                        menus,\n                    });\n                    if (result?.newNav) {\n                        await checkEveryMenuForData({\n                            instance,\n                            menuData,\n                            navToGoTo: result.newNav,\n                            userToSend,\n                            telegramParams,\n                            menus,\n                            isUserActiveCheckbox,\n                            token,\n                            directoryPicture,\n                            timeoutKey,\n                        });\n                    }\n                    return true;\n                }\n                await sendNav(instance, part, userToSend, telegramParams);\n                return true;\n            }\n\n            if (part?.switch) {\n                await handleSetState(instance, part, userToSend, null, telegramParams);\n                return true;\n            }\n\n            if (part?.getData) {\n                await getState(instance, part, userToSend, telegramParams);\n                return true;\n            }\n\n            if (part?.sendPic) {\n                timeouts = sendPic(\n                    instance,\n                    part,\n                    userToSend,\n                    telegramParams,\n                    token,\n                    directoryPicture,\n                    timeouts,\n                    timeoutKey,\n                );\n                return true;\n            }\n\n            if (part?.location) {\n                adapter.log.debug('Send location');\n                await sendLocationToTelegram(instance, userToSend, part.location, telegramParams);\n                return true;\n            }\n\n            if (part?.echarts) {\n                adapter.log.debug('Send echarts');\n                getChart(instance, part.echarts, directoryPicture, userToSend, telegramParams);\n                return true;\n            }\n\n            if (part?.httpRequest) {\n                adapter.log.debug('Send http request');\n                const result = await httpRequest(instance, part, userToSend, telegramParams, directoryPicture);\n                return !!result;\n            }\n        }\n        if (isSubmenuOrMenu(calledValue) && menuData[groupWithUser][call]) {\n            adapter.log.debug('Call Submenu');\n            await callSubMenu({\n                instance,\n                jsonStringNav: calledValue,\n                userToSend: userToSend,\n                telegramParams: telegramParams,\n                part: part,\n                allMenusWithData: allMenusWithData,\n                menus: menus,\n            });\n            return true;\n        }\n        return false;\n    } catch (e: any) {\n        errorLogger('Error processData:', e, adapter);\n    }\n}\n\nexport function getTimeouts(): Timeouts[] {\n    return timeouts;\n}\n"],
  "mappings": "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",
  "names": []
}
