{
  "version": 3,
  "sources": ["../../src/app/sendpic.ts"],
  "sourcesContent": ["import { sendToTelegram } from './telegram';\nimport { checkDirectoryIsOk, replaceAll } from './global';\nimport { exec } from 'child_process';\nimport { errorLogger } from './logging';\nimport { _this } from '../main';\nimport type { Part, UserListWithChatId } from '../types/types';\n\nfunction sendPic(\n    part: Part,\n    userToSend: string,\n    instanceTelegram: string,\n    resize_keyboard: boolean,\n    one_time_keyboard: boolean,\n    userListWithChatID: UserListWithChatId[],\n    token: string,\n    directoryPicture: string,\n    timeouts: Timeouts[],\n    timeoutKey: string,\n): Timeouts[] {\n    try {\n        part.sendPic?.forEach(element => {\n            const { id, delay, fileName } = element;\n            let path = '';\n            if (id != '-') {\n                const newUrl = replaceAll(id, '&amp;', '&');\n\n                exec(\n                    `curl -H \"Autorisation: Bearer ${token.trim()}\" \"${newUrl}\" > ${directoryPicture}${fileName}`,\n                    (error: any, stdout: any, stderr: any) => {\n                        if (stdout) {\n                            _this.log.debug(`Stdout: ${stdout}`);\n                        }\n                        if (stderr) {\n                            _this.log.debug(`Stderr: ${stderr}`);\n                        }\n                        if (error) {\n                            errorLogger('Error in exec:', error);\n\n                            return;\n                        }\n                    },\n                );\n\n                _this.log.debug(`Delay Time: ${delay}`);\n                timeoutKey += 1;\n\n                if (!checkDirectoryIsOk(directoryPicture)) {\n                    return;\n                }\n\n                path = `${directoryPicture}${fileName}`;\n                _this.log.debug(`Path: ${path}`);\n            } else {\n                return;\n            }\n\n            const timeout = _this.setTimeout(\n                async () => {\n                    await sendToTelegram({\n                        user: userToSend,\n                        textToSend: path,\n                        instance: instanceTelegram,\n                        resize_keyboard: resize_keyboard,\n                        one_time_keyboard: one_time_keyboard,\n                        userListWithChatID: userListWithChatID,\n                        parse_mode: 'false',\n                    });\n                    let timeoutToClear: Timeouts[] = [];\n                    timeoutToClear = timeouts.filter(item => item.key == timeoutKey);\n                    timeoutToClear.forEach(item => {\n                        _this.clearTimeout(item.timeout);\n                    });\n\n                    timeouts = timeouts.filter(item => item.key !== timeoutKey);\n\n                    _this.log.debug('Picture sent');\n                },\n                parseInt(String(element.delay)),\n            );\n\n            if (timeout) {\n                timeouts.push({ key: timeoutKey, timeout: timeout });\n            }\n        });\n        return timeouts;\n    } catch (e: any) {\n        errorLogger('Error send pic:', e);\n    }\n    return timeouts;\n}\n\nexport { sendPic };\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA+B;AAC/B,oBAA+C;AAC/C,2BAAqB;AACrB,qBAA4B;AAC5B,kBAAsB;AAGtB,SAAS,QACL,MACA,YACA,kBACA,iBACA,mBACA,oBACA,OACA,kBACA,UACA,YACU;AAlBd;AAmBI,MAAI;AACA,eAAK,YAAL,mBAAc,QAAQ,aAAW;AAC7B,YAAM,EAAE,IAAI,OAAO,SAAS,IAAI;AAChC,UAAI,OAAO;AACX,UAAI,MAAM,KAAK;AACX,cAAM,aAAS,0BAAW,IAAI,SAAS,GAAG;AAE1C;AAAA,UACI,iCAAiC,MAAM,KAAK,CAAC,MAAM,MAAM,OAAO,gBAAgB,GAAG,QAAQ;AAAA,UAC3F,CAAC,OAAY,QAAa,WAAgB;AACtC,gBAAI,QAAQ;AACR,gCAAM,IAAI,MAAM,WAAW,MAAM,EAAE;AAAA,YACvC;AACA,gBAAI,QAAQ;AACR,gCAAM,IAAI,MAAM,WAAW,MAAM,EAAE;AAAA,YACvC;AACA,gBAAI,OAAO;AACP,8CAAY,kBAAkB,KAAK;AAEnC;AAAA,YACJ;AAAA,UACJ;AAAA,QACJ;AAEA,0BAAM,IAAI,MAAM,eAAe,KAAK,EAAE;AACtC,sBAAc;AAEd,YAAI,KAAC,kCAAmB,gBAAgB,GAAG;AACvC;AAAA,QACJ;AAEA,eAAO,GAAG,gBAAgB,GAAG,QAAQ;AACrC,0BAAM,IAAI,MAAM,SAAS,IAAI,EAAE;AAAA,MACnC,OAAO;AACH;AAAA,MACJ;AAEA,YAAM,UAAU,kBAAM;AAAA,QAClB,YAAY;AACR,oBAAM,gCAAe;AAAA,YACjB,MAAM;AAAA,YACN,YAAY;AAAA,YACZ,UAAU;AAAA,YACV;AAAA,YACA;AAAA,YACA;AAAA,YACA,YAAY;AAAA,UAChB,CAAC;AACD,cAAI,iBAA6B,CAAC;AAClC,2BAAiB,SAAS,OAAO,UAAQ,KAAK,OAAO,UAAU;AAC/D,yBAAe,QAAQ,UAAQ;AAC3B,8BAAM,aAAa,KAAK,OAAO;AAAA,UACnC,CAAC;AAED,qBAAW,SAAS,OAAO,UAAQ,KAAK,QAAQ,UAAU;AAE1D,4BAAM,IAAI,MAAM,cAAc;AAAA,QAClC;AAAA,QACA,SAAS,OAAO,QAAQ,KAAK,CAAC;AAAA,MAClC;AAEA,UAAI,SAAS;AACT,iBAAS,KAAK,EAAE,KAAK,YAAY,QAAiB,CAAC;AAAA,MACvD;AAAA,IACJ;AACA,WAAO;AAAA,EACX,SAAS,GAAQ;AACb,oCAAY,mBAAmB,CAAC;AAAA,EACpC;AACA,SAAO;AACX;",
  "names": []
}
